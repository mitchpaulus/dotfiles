#!/usr/bin/env mshell

args len 1 < ("Usage: docx2pdf <docx-file> [pdf-file]" wl 0 exit) iff

'.docx' tempFileExt tmpfile!

$"Tmp File {@tmpfile}" wle
$1 @tmpfile cp
$"Converting '{@tmpfile}' to PDF..." wle

runtime "windows" != if
    [wslpath -w -a @tmpfile]*! trim input-docx!
else
    @tmpfile input-docx!
end

runtime "windows" = if
    `C:\Program Files\Microsoft Office\root\Office16\WINWORD.EXE` word!
else
    'WINWORD.EXE' word!
end

[@word @input-docx /mMpPrintToPDF]!
"Successfully printed to PDF." wle

def move-result-file (--)
    runtime "windows" = if
        $TMP toPath `docx.pdf` / $2 mv
    else
        ['mv' [wslpath -u [winenv TMP]*! chomp ]*! chomp "/docx.pdf" + $2];
    end
end

# If a second arg, it is the name of the output file.
args len 1 >
(move-result-file)
iff

# OLD
# Get from https://github.com/cognidox/OfficeToPDF
# OfficeToPDF.exe '/bookmarks' '/readonly' '/noquit' '/working_dir' 'C:\Users\mpaulus\tmp' "$@"
